import React, { useState } from 'react';
import {
  Container,
  Typography,
  Box,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  TextField,
  InputAdornment,
  Divider,
  Paper,
  Button,
  Grid
} from '@mui/material';
import {
  ExpandMore as ExpandMoreIcon,
  Search as SearchIcon,
  Email as EmailIcon
} from '@mui/icons-material';
import { Link } from 'react-router-dom';

const FAQ = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [expanded, setExpanded] = useState(false);

  // Обработчик изменения поискового запроса
  const handleSearchChange = (event) => {
    setSearchTerm(event.target.value);
  };

  // Обработчик раскрытия/скрытия аккордеона
  const handleAccordionChange = (panel) => (event, isExpanded) => {
    setExpanded(isExpanded ? panel : false);
  };

  // Данные FAQ
  const faqData = [
    {
      category: 'Общие вопросы',
      items: [
        {
          question: 'Что такое WishFlick?',
          answer: 'WishFlick — это платформа для создания вишлистов и получения донатов. Сервис позволяет пользователям создавать списки желаемых товаров или услуг, а их друзьям, подписчикам или просто неравнодушным людям — делать донаты на реализацию этих желаний.'
        },
        {
          question: 'Как зарегистрироваться на платформе?',
          answer: 'Для регистрации на платформе WishFlick необходимо нажать кнопку "Регистрация" в верхнем меню сайта, заполнить форму регистрации, указав свой email, имя и пароль, и подтвердить регистрацию по ссылке, которая придет на указанный email.'
        },
        {
          question: 'Сколько стоит использование сервиса?',
          answer: 'Базовое использование сервиса WishFlick бесплатно. Мы взимаем комиссию только с полученных донатов в размере 5% от суммы. Все остальные функции, включая создание вишлистов, их редактирование и публикацию, доступны бесплатно.'
        },
        {
          question: 'Какие валюты поддерживает сервис?',
          answer: 'В настоящее время сервис WishFlick поддерживает следующие валюты: российский рубль (RUB). В будущем планируется добавление поддержки других валют.'
        },
        {
          question: 'Как связаться с поддержкой?',
          answer: 'Вы можете связаться с нашей службой поддержки, отправив письмо на адрес support@wishflick.ru или воспользовавшись формой обратной связи в разделе "Контакты". Мы стараемся отвечать на все запросы в течение 24 часов.'
        }
      ]
    },
    {
      category: 'Вишлисты',
      items: [
        {
          question: 'Как создать вишлист?',
          answer: 'Для создания вишлиста необходимо войти в свой аккаунт, перейти в раздел "Мои вишлисты" и нажать кнопку "Создать вишлист". Затем нужно заполнить информацию о вишлисте: название, описание, категорию и добавить желаемые товары или услуги.'
        },
        {
          question: 'Сколько вишлистов я могу создать?',
          answer: 'В базовой версии сервиса вы можете создать до 10 вишлистов. Это ограничение может быть изменено администрацией сервиса в будущем.'
        },
        {
          question: 'Как добавить товар в вишлист?',
          answer: 'Для добавления товара в вишлист нужно открыть существующий вишлист или создать новый, нажать кнопку "Добавить товар" и заполнить информацию о товаре: название, описание, стоимость, ссылку на товар в интернет-магазине (опционально) и загрузить изображение товара (опционально).'
        },
        {
          question: 'Могу ли я редактировать вишлист после его создания?',
          answer: 'Да, вы можете редактировать свои вишлисты в любое время. Для этого нужно открыть вишлист и нажать кнопку "Редактировать". Вы можете изменить название, описание, категорию вишлиста, а также добавлять, редактировать и удалять товары.'
        },
        {
          question: 'Как поделиться вишлистом с друзьями?',
          answer: 'Для того чтобы поделиться вишлистом, откройте его и нажмите кнопку "Поделиться". Вы получите ссылку на вишлист, которую можете отправить друзьям через социальные сети, мессенджеры или по email. Также вы можете настроить приватность вишлиста, чтобы он был доступен только по ссылке или был виден всем пользователям сервиса.'
        },
        {
          question: 'Могу ли я сделать вишлист приватным?',
          answer: 'Да, при создании или редактировании вишлиста вы можете выбрать настройку приватности. Доступны следующие варианты: "Публичный" (виден всем пользователям сервиса), "По ссылке" (доступен только тем, у кого есть ссылка) и "Приватный" (виден только вам).'
        }
      ]
    },
    {
      category: 'Донаты',
      items: [
        {
          question: 'Как сделать донат?',
          answer: 'Для того чтобы сделать донат, найдите интересующий вас вишлист, выберите товар, на который хотите сделать донат, нажмите кнопку "Поддержать" или "Донат", укажите сумму доната и выберите способ оплаты. После успешной оплаты донат будет зачислен на баланс получателя.'
        },
        {
          question: 'Какие способы оплаты доступны?',
          answer: 'В настоящее время на платформе WishFlick доступны следующие способы оплаты: банковские карты (Visa, MasterCard, МИР), электронные кошельки (ЮMoney, QIWI). Мы постоянно работаем над добавлением новых способов оплаты.'
        },
        {
          question: 'Какая минимальная и максимальная сумма доната?',
          answer: 'Минимальная сумма доната составляет 50 рублей, максимальная — 50 000 рублей. Эти ограничения могут быть изменены администрацией сервиса.'
        },
        {
          question: 'Какая комиссия взимается с донатов?',
          answer: 'Комиссия сервиса WishFlick составляет 5% от суммы доната. Также могут взиматься комиссии платежных систем, которые зависят от выбранного способа оплаты.'
        },
        {
          question: 'Могу ли я сделать анонимный донат?',
          answer: 'Да, при оформлении доната вы можете выбрать опцию "Анонимный донат". В этом случае получатель не будет видеть ваше имя и контактную информацию.'
        },
        {
          question: 'Можно ли отменить донат?',
          answer: 'После успешного завершения платежа отменить донат невозможно. Если у вас возникли проблемы с оплатой или вы считаете, что произошла ошибка, пожалуйста, обратитесь в службу поддержки.'
        }
      ]
    },
    {
      category: 'Финансы и вывод средств',
      items: [
        {
          question: 'Как вывести средства с баланса?',
          answer: 'Для вывода средств с баланса необходимо перейти в раздел "Баланс" в личном кабинете, нажать кнопку "Вывести средства", указать сумму и выбрать способ вывода (банковская карта, электронный кошелек и т.д.). После подтверждения заявка на вывод будет обработана в течение 1-3 рабочих дней.'
        },
        {
          question: 'Какие способы вывода средств доступны?',
          answer: 'В настоящее время доступны следующие способы вывода средств: на банковскую карту (Visa, MasterCard, МИР), на электронные кошельки (ЮMoney, QIWI), на банковский счет (по реквизитам).'
        },
        {
          question: 'Какая минимальная сумма для вывода средств?',
          answer: 'Минимальная сумма для вывода средств составляет 100 рублей.'
        },
        {
          question: 'Взимается ли комиссия за вывод средств?',
          answer: 'При выводе средств взимается комиссия в размере 2% от суммы, но не менее 30 рублей. Также могут взиматься комиссии платежных систем, которые зависят от выбранного способа вывода.'
        },
        {
          question: 'Сколько времени занимает вывод средств?',
          answer: 'Обработка заявки на вывод средств занимает от 1 до 3 рабочих дней. После обработки заявки время зачисления средств зависит от выбранного способа вывода и может составлять от нескольких минут до 5 рабочих дней.'
        }
      ]
    },
    {
      category: 'Безопасность и конфиденциальность',
      items: [
        {
          question: 'Как защищены мои персональные данные?',
          answer: 'Мы используем современные методы шифрования для защиты ваших персональных данных. Все данные передаются по защищенному протоколу HTTPS. Мы не передаем ваши персональные данные третьим лицам без вашего согласия, за исключением случаев, предусмотренных законодательством.'
        },
        {
          question: 'Как защищены платежные данные?',
          answer: 'Мы не храним данные ваших банковских карт. Все платежи обрабатываются через защищенные платежные шлюзы, которые соответствуют стандарту безопасности PCI DSS.'
        },
        {
          question: 'Что делать, если я забыл пароль?',
          answer: 'Если вы забыли пароль, воспользуйтесь функцией "Забыли пароль?" на странице входа. Введите email, указанный при регистрации, и мы отправим вам ссылку для сброса пароля.'
        },
        {
          question: 'Как изменить пароль?',
          answer: 'Для изменения пароля перейдите в раздел "Настройки" в личном кабинете, выберите вкладку "Безопасность" и нажмите кнопку "Изменить пароль". Вам нужно будет ввести текущий пароль и новый пароль дважды для подтверждения.'
        },
        {
          question: 'Как удалить аккаунт?',
          answer: 'Для удаления аккаунта перейдите в раздел "Настройки" в личном кабинете, выберите вкладку "Аккаунт" и нажмите кнопку "Удалить аккаунт". Вам будет предложено подтвердить удаление. Обратите внимание, что удаление аккаунта необратимо и приведет к потере всех данных, связанных с вашим аккаунтом.'
        }
      ]
    }
  ];

  // Фильтрация вопросов по поисковому запросу
  const filteredFaqData = searchTerm
    ? faqData.map(category => ({
        ...category,
        items: category.items.filter(item =>
          item.question.toLowerCase().includes(searchTerm.toLowerCase()) ||
          item.answer.toLowerCase().includes(searchTerm.toLowerCase())
        )
      })).filter(category => category.items.length > 0)
    : faqData;

  return (
    <Container maxWidth="lg" sx={{ py: 4 }}>
      <Typography variant="h4" component="h1" gutterBottom>
        Часто задаваемые вопросы
      </Typography>
      
      {/* Поиск по FAQ */}
      <Box sx={{ mb: 4 }}>
        <TextField
          fullWidth
          placeholder="Поиск по вопросам и ответам"
          value={searchTerm}
          onChange={handleSearchChange}
          InputProps={{
            startAdornment: (
              <InputAdornment position="start">
                <SearchIcon />
              </InputAdornment>
            ),
          }}
        />
      </Box>
      
      {/* Отображение FAQ */}
      {filteredFaqData.length > 0 ? (
        filteredFaqData.map((category, categoryIndex) => (
          <Box key={categoryIndex} sx={{ mb: 4 }}>
            <Typography variant="h5" component="h2" gutterBottom>
              {category.category}
            </Typography>
            {category.items.map((item, itemIndex) => (
              <Accordion
                key={itemIndex}
                expanded={expanded === `${categoryIndex}-${itemIndex}`}
                onChange={handleAccordionChange(`${categoryIndex}-${itemIndex}`)}
                sx={{ mb: 1 }}
              >
                <AccordionSummary
                  expandIcon={<ExpandMoreIcon />}
                  aria-controls={`panel${categoryIndex}-${itemIndex}-content`}
                  id={`panel${categoryIndex}-${itemIndex}-header`}
                >
                  <Typography variant="subtitle1">{item.question}</Typography>
                </AccordionSummary>
                <AccordionDetails>
                  <Typography variant="body1">{item.answer}</Typography>
                </AccordionDetails>
              </Accordion>
            ))}
          </Box>
        ))
      ) : (
        <Box sx={{ textAlign: 'center', py: 4 }}>
          <Typography variant="h6" color="text.secondary">
            По вашему запросу ничего не найдено
          </Typography>
          <Typography variant="body1" color="text.secondary" sx={{ mt: 1 }}>
            Попробуйте изменить поисковый запрос или сбросить фильтр
          </Typography>
          <Button
            variant="outlined"
            color="primary"
            onClick={() => setSearchTerm('')}
            sx={{ mt: 2 }}
          >
            Сбросить поиск
          </Button>
        </Box>
      )}
      
      {/* Секция с дополнительной помощью */}
      <Paper sx={{ p: 3, mt: 4 }}>
        <Typography variant="h5" gutterBottom>
          Не нашли ответ на свой вопрос?
        </Typography>
        <Typography variant="body1" paragraph>
          Если вы не нашли ответ на свой вопрос, вы можете связаться с нашей службой поддержки. Мы постараемся ответить вам в течение 24 часов.
        </Typography>
        <Grid container spacing={2}>
          <Grid item xs={12} md={6}>
            <Button
              variant="contained"
              color="primary"
              startIcon={<EmailIcon />}
              component={Link}
              to="/contact"
              fullWidth
            >
              Написать в поддержку
            </Button>
          </Grid>
          <Grid item xs={12} md={6}>
            <Button
              variant="outlined"
              color="primary"
              component={Link}
              to="/about"
              fullWidth
            >
              О сервисе
            </Button>
          </Grid>
        </Grid>
      </Paper>
    </Container>
  );
};

export default FAQ;